<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title></title>
<link rel="stylesheet" href="../css/bep.css" type="text/css" />
</head>
<body>
<div class="document">

<div id="upper" class="clear">
<div id="wrap">
<div id="header">
<h1><a href="../index.html">BitTorrent<span>.org</span></a></h1>
</div>
<div id="nav">
<ul>
<li><a href="../index.html">Home</a></li>
<li><a href="../introduction.html">For Users</a></li>
<li><a href="bep_0000.html"><span>For Developers</span></a></li>
<!-- <li><a href="./blog">Blog</a></li> -->
<li><a href="http://forum.bittorrent.org"> Forums </li>
<li><a href="../donate.html">Donate!</a></li>
</ul>
</div> <!-- nav -->
<!-- ### Begin Content ### -->
<div id="second">



<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">BEP:</th><td class="field-body">32</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">BitTorrent DHT Extensions for IPv6</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">11182</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="http://bittorrent.org/trac/browser/dotorg/trunk/html/beps/bep_0032.rst">2009-10-16 02:42:16 +0000 (Fri, 16 Oct 2009)</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Juliusz Chroboczek &lt;jch&#32;&#97;t&#32;pps.jussieu.fr&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Draft</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Requires:</th><td class="field-body"><a class="reference external" href="http://www.bittorrent.org/beps/bep-0005">5</a></td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="http://www.bittorrent.org/beps/bep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">14-Oct-2009</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">15-Oct-2009: Promote same ID in IPv6 and IPv4 nodes. Drop values6. Added some rationales</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id3">Abstract</a></li>
<li><a class="reference internal" href="#introduction" id="id4">Introduction</a></li>
<li><a class="reference internal" href="#operation" id="id5">Operation</a><ul>
<li><a class="reference internal" href="#single-protocol-nodes" id="id6">Single-protocol nodes</a></li>
<li><a class="reference internal" href="#double-stack-nodes" id="id7">Double-stack nodes</a><ul>
<li><a class="reference internal" href="#bootstrapping" id="id8">Bootstrapping</a></li>
<li><a class="reference internal" href="#steady-state-operation" id="id9">Steady-state operation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#changes-and-extensions-to-existing-messages" id="id10">Changes and extensions to existing messages</a><ul>
<li><a class="reference internal" href="#changes-to-existing-parameters" id="id11">Changes to existing parameters</a><ul>
<li><a class="reference internal" href="#values" id="id12">values</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-parameters" id="id13">New parameters</a><ul>
<li><a class="reference internal" href="#nodes6" id="id14">nodes6</a></li>
<li><a class="reference internal" href="#want" id="id15">want</a></li>
</ul>
</li>
<li><a class="reference internal" href="#changes-to-message-semantics" id="id16">Changes to message semantics</a><ul>
<li><a class="reference internal" href="#find-nodes-and-get-peers" id="id17">find_nodes and get_peers</a></li>
<li><a class="reference internal" href="#announce-peers" id="id18">announce_peers</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#acknowledgements" id="id19">Acknowledgements</a></li>
<li><a class="reference internal" href="#references" id="id20">References</a></li>
<li><a class="reference internal" href="#copyright" id="id21">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1>Abstract</h1>
<p>This proposal describes a set of extensions to the BitTorrent DHT <a class="footnote-reference" href="#bep-5" id="id1">[1]</a>
to allow operation over IPv6.</p>
<p><strong>This is a very early draft</strong>, and <strong>not suitable for implementation</strong>.  Yet.</p>
</div>
<div class="section" id="introduction">
<h1>Introduction</h1>
<p>The address exhaustion of the IPv4 Internet, and the coincident deployment
of Network Address Translation (NAT) devices, severely limits the
performance of the BitTorrent protocol by making an increasing number of
peers unreachable.  The simple and efficient solution to this problem is to
deploy BitTorrent over the IPv6 protocol, which does not suffer from
address exhaustion.</p>
<p>A number of extensions (mostly undocumented) to the BitTorrent protocol
have been defined in order to allow it to operate over IPv6.
Unfortunately, these extensions only allow locating IPv6 peers by using
trackers or through peer exchange -- but not from the DHT.  This document
describes the procedures and message formats needed to deploy an IPv6
version of the BitTorrent DHT.</p>
<p>The extension described in this document also solves a long-standing
issue with the protocol defined in BEP-5.  The presence of contact
information in the reply is no longer governed by the presence of
a &quot;values&quot; key; this avoids the well-known problem of contact
information being masked by peer information.  While this is an
incompatible change, it is believed to be properly handled by all
deployed implementations.</p>
</div>
<div class="section" id="operation">
<h1>Operation</h1>
<p>There are two distinct DHTs: the existing IPv4 DHT, and the new IPv6 DHT.</p>
<p>The two DHTs are independent, meaning that no IPv6 data is stored in the
IPv4 DHT, and, conversely, no IPv4 data is stored in the IPv6 DHT.  A node
wishing to participate in both DHTs must maintain two distinct routing
tables, one for IPv4 and one for IPv6.</p>
<p>While this is not strictly necessary, a node should use the same node
id in both tables.  This simplifies implementation and debugging, and
slightly increases efficiency in the case where the two DHTs are
mostly congruent.</p>
<p>By default, messages only carry data in the address family implied by the
network layer protocol.  In the case of the &quot;nodes&quot; and &quot;nodes6&quot; arguments
in replies to the find_nodes and get_peers requests, however, the requestor
may request that the reply contain &quot;nodes&quot;, &quot;nodes6&quot; or both fields.</p>
<div class="section" id="single-protocol-nodes">
<h2>Single-protocol nodes</h2>
<p>A single-protocol node (IPv4 or IPv6) only participates in one DHT.  Such
a node does not need to explicitly request data in a given family -- the
data provided by default is exactly what it needs.</p>
</div>
<div class="section" id="double-stack-nodes">
<h2>Double-stack nodes</h2>
<p>While conceptually equivalent to a pair of single-protocol nodes,
a double-stack (IPv4 and IPv6) node can make bootstrap faster and
improve the reliability of the protocol by &quot;leaking&quot; data between the
two DHTs, as described in the following paragraphs.</p>
<div class="section" id="bootstrapping">
<h3>Bootstrapping</h3>
<p>A double-stack node that is bootstrapping its DHT will send find_nodes
requests in order to populate its routing tables.  In order to accelerate
this process, it should request both &quot;nodes&quot; and &quot;nodes6&quot; fields.</p>
</div>
<div class="section" id="steady-state-operation">
<h3>Steady-state operation</h3>
<p>Once bootstrap is successful, a node should normally only request
&quot;nodes&quot; replies from IPv4 nodes, and &quot;nodes6&quot; replies from IPv6 nodes.
Requesting both address families in all requests is unlikely to
provide useful information, and hence uselessly increases network
traffic.</p>
<p>In order to increase the reliability of the DHT after a single-protocol
network outage, however, a node may <em>ocasionally</em> send a request for
&quot;nodes&quot; to an IPv6 node, or a request for &quot;nodes6&quot; to an IPv4 node.</p>
</div>
</div>
</div>
<div class="section" id="changes-and-extensions-to-existing-messages">
<h1>Changes and extensions to existing messages</h1>
<div class="section" id="changes-to-existing-parameters">
<h2>Changes to existing parameters</h2>
<div class="section" id="values">
<h3>values</h3>
<p>In a reply sent over IPv4, the &quot;values&quot; parameter contains a list of
strings, each of which contains compact format IPv4 contact
information for a single peer.</p>
<p>In a reply sent over IPv6, &quot;values' contains a list of strings, each
of which contains compact format IPv6 contact information for a single
peer.</p>
<p>Implementations of this specification must be able to properly parse
hybrid &quot;values&quot; lists -- lists containing an arbitrary mixture of
6-octet IPv4 values and 18-octet IPv6 values.  However,
implementations should not send such hybrid lists, and must not send
hybrid lists in a reply to an IPv4 request that doesn't contain
a &quot;want&quot; parameter.</p>
<blockquote>
<strong>Rationale</strong>: a request sent over IPv4 with no &quot;want&quot; parameter
could originate from a node that implements plain BEP-5, and which
might therefore be unable to parse a hybrid list.</blockquote>
</div>
</div>
<div class="section" id="new-parameters">
<h2>New parameters</h2>
<div class="section" id="nodes6">
<h3>nodes6</h3>
<p>The &quot;nodes6&quot; parameter is analogous to the existing &quot;nodes&quot; parameter:
when present, it carries a string containing the compact IPv6 node
info for the 8 closest good nodes in the sending node's IPv6 routing
table.  This parameter is allowed in replies to the find_nodes and
get_peers messages (see below).</p>
</div>
<div class="section" id="want">
<h3>want</h3>
<p>The &quot;want&quot; parameter is allowed in the find_nodes and get_peers requests,
and governs the presence or absence of the &quot;nodes&quot; and &quot;nodes6&quot; parameters
in the requested reply.  Its value is a string of one or more characters,
which may include</p>
<blockquote>
<ul class="simple">
<li>&quot;4&quot;: the node requests the presence of a &quot;nodes&quot; key;</li>
<li>&quot;6&quot;: the node requests the presence of a &quot;nodes6&quot; key.</li>
</ul>
</blockquote>
<p>For future extensibility, other characters may be present in the string,
and must be silently ignored on reception.</p>
<blockquote>
<strong>Note</strong>: the &quot;want&quot; parameter is currently under discussion.  It
has been suggested that it should be renamed to &quot;flags&quot;, and that
it should be a list of flags rather than a string.  This author
is not convinced yet.</blockquote>
</div>
</div>
<div class="section" id="changes-to-message-semantics">
<h2>Changes to message semantics</h2>
<div class="section" id="find-nodes-and-get-peers">
<h3>find_nodes and get_peers</h3>
<p>A node sending a find_nodes or get_peers request should include
a &quot;want&quot; parameter containing one or both of the characters &quot;4&quot; or
&quot;6&quot;.  A node replying to a find_nodes or get_peers request should
include a &quot;nodes&quot; parameter if and only if the request's &quot;want&quot;
parameter included a &quot;4&quot;, and should include a &quot;nodes6&quot; parameter if
and only if the request's &quot;want&quot; parameter included a &quot;6&quot;.</p>
<p>In the absence of a &quot;want&quot; parameter, the reply should include &quot;nodes&quot;
if the request was sent over IPv4, and should include &quot;nodes6&quot; if the
request was sent over IPv6.</p>
<blockquote>
<strong>Rationale</strong>: this is an incompatible change to the protocol
defined in BEP-5 <a class="footnote-reference" href="#bep-5" id="id2">[1]</a>, which specifies that &quot;nodes&quot; and
&quot;values&quot; are mutually exclusive.  However, this change makes the DHT
more reliable, and has been deployed by most implementations for
over a year with no negative effects.</blockquote>
<p>When a node receives a get_peers request and it has contact
information for the matching address family and info-hash, it should
additionally include a &quot;values&quot; parameter containing a list of 6-octet
strings if the request was sent over IPv4, and a list of 18-octet
strings if the request was sent over IPv6.</p>
<p>A reply sent over IPv4 should not contain 18-octet IPv6 contact
information, and a reply sent over IPv6 should not contain 6-octet
IPv4 contact information.  In other words, the &quot;want&quot; parameter only
governs the presence of the &quot;nodes&quot; and &quot;nodes6&quot; parameters, not the
interpretation of &quot;values&quot;.</p>
<blockquote>
<strong>Rationale</strong>: if the requesting node is a single-stack node, it has
no interest in values of the other address family.  If the
requesting node is a double-stack node, then it must perform the two
announces in parallel; providing both sets of data in both sets of
replies merely increases the amount of traffic without giving any
extra information.</blockquote>
</div>
<div class="section" id="announce-peers">
<h3>announce_peers</h3>
<p>The syntax of the announce_peers request and reply are unchanged.  This
implies that an announce_peers request sent over IPv4 may only advertise an
IPv4 address, and an announce_peers request sent over IPv6 may only
advertise an IPv6 address.</p>
</div>
</div>
</div>
<div class="section" id="acknowledgements">
<h1>Acknowledgements</h1>
<p>I gratefully acknowledge the influence of <em>The 8472</em> and <em>arvid</em> over
this work.</p>
</div>
<div class="section" id="references">
<h1>References</h1>
<table class="docutils footnote" frame="void" id="bep-5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>)</em> BEP_0005.  DHT Protocol.
(<a class="reference external" href="http://www.bittorrent.org/beps/bep_0005.html">http://www.bittorrent.org/beps/bep_0005.html</a>)</td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1>Copyright</h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>


</div>
	<div id="footer">
<hr/>
</div>

</div>
</body>
</html>
